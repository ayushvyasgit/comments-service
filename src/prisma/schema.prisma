generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Tenant {
  id        String   @id @default(uuid()) @db.Uuid
  name      String
  subdomain String   @unique
  apiKey    String   @unique
  plan      Plan     @default(FREE)
  status    TenantStatus @default(ACTIVE)
  
  rateLimitPerMinute Int @default(100) @map("rate_limit_per_minute")
  rateLimitPerHour   Int @default(1000) @map("rate_limit_per_hour")
  
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  
  comments  Comment[]
  
  @@map("tenants")
}

enum Plan {
  FREE
  STARTER
  BUSINESS
  ENTERPRISE
}

enum TenantStatus {
  ACTIVE
  SUSPENDED
  DELETED
}

model Comment {
  id          String   @id @default(uuid()) @db.Uuid
  
  tenantId    String   @map("tenant_id") @db.Uuid
  tenant      Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  
  entityId    String   @map("entity_id")
  
  parentId    String?  @map("parent_id") @db.Uuid
  parent      Comment? @relation("CommentReplies", fields: [parentId], references: [id], onDelete: Cascade)
  replies     Comment[] @relation("CommentReplies")
  
  depth       Int      @default(0)
  path        String   @default("")
  
  authorId    String   @map("author_id")
  authorName  String   @map("author_name")
  authorEmail String?  @map("author_email")
  
  content     String   @db.Text
  
  status      CommentStatus @default(ACTIVE)
  
  likeCount   Int      @default(0) @map("like_count")
  replyCount  Int      @default(0) @map("reply_count")
  
  deletedAt   DateTime? @map("deleted_at")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  
  @@index([tenantId, entityId, createdAt])
  @@index([tenantId, parentId])
  @@index([tenantId, status])
  @@map("comments")
}

enum CommentStatus {
  ACTIVE
  DELETED
  FLAGGED
  SPAM
}